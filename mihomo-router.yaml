#------------------------------------------------------------------
#-- Settings
#-------------------------------------------------------External_UI
secret: ""
external-ui: "/etc/nikki/run/ui" # Nikki
external-ui-name: Zashboard
external-ui-url: "https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip"
external-controller: "[::]:9090"
#---------------------------------------------------------LAN_Proxy
allow-lan: true
bind-address: "*"
port: 8080
socks-port: 1080
mixed-port: 7890
redir-port: 7891
tproxy-port: 7892
#--------------------------------------------------------------misc
log-level: warning
mode: rule
ipv6: false
find-process-mode: off
unified-delay: true
tcp-concurrent: true
profile:
  store-selected: true
  store-fake-ip: true
proxies: null
#------------------------------------------------------------------
#-- TUN
#------------------------------------------------------------------
tun:
  enable: true
  stack: mixed
  dns-hijack: ["any:53", "tcp://any:53"]
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
#------------------------------------------------------------------
#-- Sniffer
#------------------------------------------------------------------
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "rule-set:private_domain,cn_domain"
    - "+.push.apple.com"
#------------------------------------------------------------------
#-- DNS
#------------------------------------------------------------------
dns:
  enable: true
  listen: "[::]:1053"
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - "+.argotunnel.com"
    - "rule-set:private_domain,cn_domain"
    - "+.services.googleapis.cn"
    - "+.xn--ngstr-lra8j.com"
    - "time.*.com"
    - "+.lan"
    - "+.local"
  default-nameserver:
    - 119.29.29.29
    - 223.5.5.5
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
#------------------------------------------------------------------
#-- Porxy Provider
#------------------------------------------------------------------
proxy-providers:
  SubStore:
    url: ""
    type: http
    interval: 43200
    proxy: DIRECT
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 900
#------------------------------------------------------------------
#-- Porxy Group
#------------------------------------------------------------anchor
p: &p {type: url-test, include-all: true, tolerance: 20, interval: 1800}
#------------------------------------------------------------------
proxy-groups:
  - {name: Default   , type: select, proxies: [HK urltest, MO urltest, KR urltest, DE urltest, SG urltest, TW urltest, JP urltest, US urltest, Selector, DIRECT, REJECT]         , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Cellular.png"}
  - {name: SNS       , type: select, proxies: [Default, HK urltest, MO urltest, KR urltest, DE urltest, SG urltest, TW urltest, JP urltest, US urltest, Selector, DIRECT, REJECT], icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Media.png"}
  - {name: YouTube   , type: select, proxies: [Default, HK urltest, MO urltest, KR urltest, DE urltest, SG urltest, TW urltest, JP urltest, US urltest, Selector, DIRECT, REJECT], icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png"}
  - {name: Google    , type: select, proxies: [Default, HK urltest, MO urltest, KR urltest, DE urltest, SG urltest, TW urltest, JP urltest, US urltest, Selector, DIRECT, REJECT], icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png"}
  - {name: AI        , type: select, proxies: [US urltest, SG urltest, TW urltest, JP urltest, KR urltest, Default, REJECT], icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/AI.png"}
  - {name: Gaming    , type: select, proxies: [Default, Selector, DIRECT]                                                  , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Game.png"}
  - {name: Passthru  , type: select, proxies: [DIRECT, Default, Selector]                                                  , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Direct.png"}
  - {name: Selector  , type: select, include-all: true                                                                     , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png"}
  - {name: US urltest, <<: *p, filter: "(?=.*(美|US|(?i)States|America))^((?!(德|澳|台|日|韩|新|港)).)*$", icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png"}
  - {name: JP urltest, <<: *p, filter: "(?=.*(日|JP|(?i)Japan))^((?!(德|尼|澳|台|港|韩|新|深|美)).)*$"   , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png"}
  - {name: TW urltest, <<: *p, filter: "(?=.*(台|TW|(?i)Taiwan))^((?!(德|澳|港|日|韩|新|深|美)).)*$"     , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png"}
  - {name: HK urltest, <<: *p, filter: "(?=.*(港|HK|(?i)Hong))^((?!(德|澳|台|日|韩|新|深|美)).)*$"       , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png"}
  - {name: SG urltest, <<: *p, filter: "(?=.*(新|SG|(?i)Sing))^((?!(德|澳|台|日|韩|港|深|美)).)*$"       , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png"}
  - {name: MO urltest, <<: *p, filter: "(?=.*(澳|MO|(?i)Macau))^((?!(德|港|台|日|韩|新|深|美)).)*$"      , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Macao.png"}
  - {name: KR urltest, <<: *p, filter: "(?=.*(韩|KR|(?i)Korean))^((?!(德|澳|台|日|港|新|深|美)).)*$"     , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png"}
  - {name: DE urltest, <<: *p, filter: "(?=.*(德|DE|(?i)Germany))^((?!(港|澳|台|日|韩|新|深|美)).)*$"    , icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Germany.png"}
#------------------------------------------------------------------
#-- Rule Provider
#------------------------------------------------------------------
rule-providers:
  #------------------------------------------------------------reject
  ad-gholts: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/Gholts/yaml/main/rule/ad.list' }
  ad-awavenue: { type: http, interval: 43200, behavior: domain, format: yaml, url: 'https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash.yaml' }
  reject_non_ip_no_drop: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/reject-no-drop.txt }
  reject_non_ip_drop: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/reject-drop.txt }
  reject_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/reject.txt }
  reject_domainset: { type: http, interval: 43200, behavior: domain, format: text, url: https://ruleset.skk.moe/Clash/domainset/reject.txt }
  #------------------------------------------------------------stream
  youtube_domain: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs' }
  stream_us_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_us.txt' }
  stream_eu_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_eu.txt' }
  stream_jp_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_jp.txt' }
  stream_kr_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_kr.txt' }
  stream_hk_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_hk.txt' }
  stream_tw_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/stream_tw.txt' }
  #--------------------------------------------------------bulk/burst
  gamedl: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/GameDownload/GameDownload.list' }
  gamedlcn: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/GameDownloadCN/GameDownloadCN.list' }
  speedtest: { type: http, interval: 43200, behavior: domain, format: text, url: 'https://ruleset.skk.moe/Clash/domainset/speedtest.txt' }
  #---------------------------------------------------------------sns
  telegram_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/telegram.txt' }
  telegram_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/ip/telegram.txt' }
  wechat: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/WeChat/WeChat.list' }
  whatsapp: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/whatsapp.mrs' }
  line: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/line.mrs' }
  discord: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/discord.mrs' }
  messenger: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/messenger.mrs' }
  #------------------------------------------------------social_media
  game_platform: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Game.list' }
  twitter: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/twitter.mrs' }
  reddit: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/reddit.mrs' }
  threads: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/threads.mrs' }
  instagram: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/instagram.mrs' }
  facebook: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/facebook.mrs' }
  dcard: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/dcard.mrs' }
  bahamut: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bahamut.mrs' }
  #-------------------------------------------artificial_intelligence
  ai-not-cn: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ai-!cn.mrs' }
  ai_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/ai.txt }
  apple_intelligence_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_intelligence.txt }
  #-------------------------------------------------------------apple
  apple_news: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AppleNews/AppleNews.list' }
  apple_music: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AppleMusic/AppleMusic.list' }
  apple_cdn: { type: http, interval: 43200, behavior: domain, format: text, url: https://ruleset.skk.moe/Clash/domainset/apple_cdn.txt }
  apple_services: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_services.txt }
  apple_cn_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/apple_cn.txt }
  #---------------------------------------------------------microsoft
  microsoft_cdn_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt' }
  microsoft_domain: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs' }
  #------------------------------------------------------------google
  google: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs' }
  google_cn: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google-cn.mrs' }
  #--------------------------------------------------------------misc
  dr-gholts: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/Gholts/yaml/main/rule/dr.list' }
  px-gholts: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://raw.githubusercontent.com/Gholts/yaml/main/rule/px.list' }
  gfw_domain: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/gfw.mrs' }
  private_domain: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs' }
  lan_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/non_ip/lan.txt }
  lan_ip: { type: http, interval: 43200, behavior: classical, format: text, url: https://ruleset.skk.moe/Clash/ip/lan.txt }
  #------------------------------------------------------------region
  global_non_ip: { type: http, interval: 43200, behavior: classical, format: text, url: 'https://ruleset.skk.moe/Clash/non_ip/global.txt' }
  geolocation-not-cn: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs' }
  cn_domain: { type: http, interval: 43200, behavior: domain, format: mrs, url: 'https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs' }
  china_ip: { type: http, interval: 43200, behavior: ipcidr, format: text, url: 'https://ruleset.skk.moe/Clash/ip/china_ip.txt' }
  china_ip_ipv6: { type: http, interval: 43200, behavior: ipcidr, format: text, url: 'https://ruleset.skk.moe/Clash/ip/china_ip_ipv6.txt' }
#------------------------------------------------------------------
#-- Routing Rule
#------------------------------------------------------------------
rules:
  - RULE-SET,dr-gholts,Passthru
  - RULE-SET,px-gholts,Default
  #------------------------------------------------------------reject
  - RULE-SET,ad-awavenue,REJECT
  - RULE-SET,ad-gholts,REJECT
  - RULE-SET,reject_non_ip_drop,REJECT-DROP
  - RULE-SET,reject_domainset,REJECT
  - RULE-SET,reject_non_ip,REJECT
  - RULE-SET,reject_non_ip_no_drop,REJECT
  #------------------------------------------------------------stream
  - RULE-SET,youtube_domain,YouTube
  - RULE-SET,stream_us_non_ip,US urltest
  - RULE-SET,stream_eu_non_ip,DE urltest
  - RULE-SET,stream_jp_non_ip,JP urltest
  - RULE-SET,stream_kr_non_ip,KR urltest
  - RULE-SET,stream_hk_non_ip,HK urltest
  - RULE-SET,stream_tw_non_ip,TW urltest
  #--------------------------------------------------------bulk/burst
  - RULE-SET,gamedl,DIRECT
  - RULE-SET,gamedlcn,DIRECT
  - RULE-SET,speedtest,Passthru
  #---------------------------------------------------------------sns
  - RULE-SET,wechat,DIRECT
  - RULE-SET,telegram_non_ip,SNS
  - RULE-SET,telegram_ip,SNS
  - RULE-SET,whatsapp,SNS
  - RULE-SET,line,SNS
  - RULE-SET,discord,SNS
  - RULE-SET,messenger,SNS
  #------------------------------------------------------social_media
  - RULE-SET,game_platform,Gaming
  - RULE-SET,twitter,SNS
  - RULE-SET,reddit,SNS
  - RULE-SET,threads,SNS
  - RULE-SET,instagram,SNS
  - RULE-SET,facebook,SNS
  - RULE-SET,dcard,TW urltest
  - RULE-SET,bahamut,TW urltest
  #-------------------------------------------artificial_intelligence
  - RULE-SET,ai-not-cn,AI
  - RULE-SET,ai_non_ip,AI
  - RULE-SET,apple_intelligence_non_ip,AI
  - DOMAIN-SUFFIX,webresultproxy.diabrowser.engineering,AI
  #-------------------------------------------------------------apple
  - RULE-SET,apple_news,US urltest
  - RULE-SET,apple_music,US urltest
  - RULE-SET,apple_cdn,Passthru
  - RULE-SET,apple_services,Passthru
  - RULE-SET,apple_cn_non_ip,Passthru
  #---------------------------------------------------------microsoft
  - RULE-SET,microsoft_cdn_non_ip,Passthru
  - RULE-SET,microsoft_domain,Default
  #------------------------------------------------------------google
  - RULE-SET,google,Google
  - RULE-SET,google_cn,Google
  #----------------------------------------------------------fallback
  - RULE-SET,private_domain,DIRECT
  - RULE-SET,lan_non_ip,DIRECT
  - RULE-SET,lan_ip,DIRECT
  - RULE-SET,global_non_ip,Default
  - RULE-SET,gfw_domain,Default
  - RULE-SET,geolocation-not-cn,Default
  - RULE-SET,cn_domain,Passthru
  - RULE-SET,china_ip,Passthru
  - RULE-SET,china_ip_ipv6,Passthru
  - MATCH,Default
